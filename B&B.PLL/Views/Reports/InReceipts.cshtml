@model B_B.BLL.ViewModels.Reports.ReportSummaryVM
@{
    var selectedYear = Context.Request.Query["year"].ToString();
    if (string.IsNullOrEmpty(selectedYear))
    {
        selectedYear = DateTime.Now.Year.ToString();
    }
    var years = Enumerable.Range(2020, DateTime.Now.Year - 2019).Reverse();
}

<div class="page-content active" dir="rtl" style="text-align:right;">
    <div class="page-header">
        <h1 class="page-title"><i class="fas fa-file-alt"></i> تقرير إيصالات المشتريات</h1>
    </div>

    <div class="content-section">

        <!-- Year Filter -->
        <div class="dashboard-card">
            <div class="card-header">
                <h3><i class="fas fa-calendar-alt"></i> اختر السنة</h3>
            </div>
            <div class="table-container">
                <form method="get" asp-action="InReceipts" asp-controller="Reports" class="filter-form">
                    <div class="form-group">
                        <label for="year">السنة</label>
                        <select id="year" name="year" class="form-control" onchange="this.form.submit()">
                            @foreach (var y in years)
                            {
                                <option value="@y" selected="@(y.ToString() == selectedYear)">
                                    @y
                                </option>
                            }
                        </select>
                    </div>
                </form>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="summary-cards">
            <div class="summary-card">
                <div class="card-icon bg-primary"><i class="fas fa-sack-dollar"></i></div>
                <div class="card-content">
                    <span class="card-label">إجمالي سعر الفواتير</span>
                    <span class="card-value text-primary">@Model.TotalAmount</span>
                </div>
            </div>
            <div class="summary-card">
                <div class="card-icon bg-info"><i class="fas fa-receipt"></i></div>
                <div class="card-content">
                    <span class="card-label">عدد الإيصالات</span>
                    <span class="card-value">@Model.TotalCount</span>
                </div>
            </div>
            <div class="summary-card">
                <div class="card-icon bg-success"><i class="fas fa-check-circle"></i></div>
                <div class="card-content">
                    <span class="card-label">المدفوع</span>
                    <span class="card-value text-success">@Model.TotalPaid</span>
                </div>
            </div>
            <div class="summary-card">
                <div class="card-icon bg-warning"><i class="fas fa-exclamation-circle"></i></div>
                <div class="card-content">
                    <span class="card-label">المتبقي</span>
                    <span class="card-value text-warning">@Model.TotalRemaining</span>
                </div>
            </div>
        </div>

        <!-- Top Supplier -->
        <div class="dashboard-card">
            <div class="card-header">
                <h3><i class="fas fa-user-tie"></i> أكثر مورد توريدًا</h3>
            </div>
            <div class="table-container">
                <div class="top-party-info">
                    <strong>@Model.TopPartyName</strong> — <span class="text-primary">@Model.TopPartyAmount</span>
                </div>
            </div>
        </div>

        <!-- Detailed Table -->
        <div class="dashboard-card">
            <div class="card-header">
                <h3><i class="fas fa-list"></i> تفاصيل الإيصالات</h3>
            </div>
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>رقم</th>
                            <th>المورد</th>
                            <th>التاريخ</th>
                            <th>الإجمالي</th>
                            <th>المدفوع</th>
                            <th>المتبقي</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Receipts)
                        {
                            <tr>
                                <td>@item.Id</td>
                                <td>@item.PartyName</td>
                                <td>@item.Date.ToShortDateString()</td>
                                <td>@item.TotalAmount</td>
                                <td class="text-success">@item.PaidAmount</td>
                                <td class="text-warning">@((item.TotalAmount - item.PaidAmount))</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>



@section Styles {
    <style>
        .dashboard-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

            .card-header h3 {
                margin: 0;
                font-size: 1.25rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

        .table-container {
            padding: 1.5rem;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

            .table th {
                background-color: var(--gray-50);
                padding: 1rem;
                font-weight: 600;
                text-align: right;
                border-bottom: 2px solid var(--gray-300);
            }

            .table td {
                padding: 1rem;
                border-bottom: 1px solid var(--gray-200);
            }

            .table tr:hover td {
                background-color: var(--gray-50);
            }

        /* Summary Cards */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .summary-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

            .summary-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
            }

        .card-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .bg-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        .bg-info {
            background: linear-gradient(135deg, #0dcaf0, #0aa2c0);
        }

        .bg-success {
            background: linear-gradient(135deg, #10b981, #047857);
        }

        .bg-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .card-content {
            flex: 1;
        }

        .card-label {
            display: block;
            font-size: 0.875rem;
            color: var(--gray-600);
            margin-bottom: 0.25rem;
        }

        .card-value {
            display: block;
            font-size: 1.5rem;
            font-weight: 700;
        }

        /* Filter Form */
        .filter-form {
            display: flex;
            gap: 1rem;
            align-items: end;
            flex-wrap: wrap;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

            .form-group label {
                font-weight: 600;
                color: var(--gray-700);
            }

        .form-control {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 0.875rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 0.5rem 1.5rem;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
        }

            .btn-primary:hover {
                transform: translateY(-1px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }

        /* Top Party Info */
        .top-party-info {
            font-size: 1.1rem;
            padding: 0.5rem 0;
        }

        /* Text colors */
        .text-primary {
            color: #3b82f6 !important;
        }

        .text-success {
            color: #10b981 !important;
        }

        .text-warning {
            color: #f59e0b !important;
        }

        .text-info {
            color: #0dcaf0 !important;
        }

        /* Responsive */
        @@media (max-width: 768px) {
            .summary-cards {
                grid-template-columns: 1fr;
            }

            .filter-form {
                flex-direction: column;
                align-items: stretch;
            }

            .table-container {
                overflow-x: auto;
            }

            .card-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
        }

        @@media (max-width: 480px) {
            .summary-card {
                flex-direction: column;
                text-align: center;
            }

            .table {
                font-size: 0.875rem;
            }

                .table th,
                .table td {
                    padding: 0.75rem 0.5rem;
                }
        }
    </style>
}