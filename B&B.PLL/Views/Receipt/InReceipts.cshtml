@model IEnumerable<B_B.BLL.ViewModels.ReceiptListVM>

<div class="page-content active" dir="rtl" style="text-align:right;">
    <div class="page-header">
        <h1 class="page-title">إيصالات الوارد</h1>
        <a asp-action="CreateInReceipt" class="btn btn-primary">
            <i class="fas fa-plus"></i> إيصال وارد جديد
        </a>
    </div>

    <div class="content-section">
        <div class="table-controls">
            <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" class="search-input" placeholder="ابحث عن إيصال..." />
            </div>
        </div>

        <div class="table-container">
            <table class="table" id="receiptsTable">
                <thead>
                    <tr>
                        <th>التاريخ</th>
                        <th>المورد</th>
                        <th>الحالة</th>
                        <th>الإجمالي</th>
                        <th>المدفوع</th>
                        <th>المرتجع</th>
                        <th>المتبقي</th>
                        <th>الإجراءات</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    @foreach (var r in Model)
                    {
                        var isOwedToSupplier = r.RemainingAmount < 0;
                        var isSupplierOwes = r.RemainingAmount > 0;
                        var isSettled = r.RemainingAmount == 0;

                        var remainingAmountClass = isOwedToSupplier ? "text-warning" :
                        (isSupplierOwes ? "text-danger" : "text-success");
                        var statusText = isOwedToSupplier ? "المورد مدين لنا" :
                        (isSupplierOwes ? "نحن مدينون للمورد" : "تم التسوية");
                        var statusIcon = isOwedToSupplier ? "fa-arrow-down" :
                        (isSupplierOwes ? "fa-arrow-up" : "fa-check");
                        var statusBg = isOwedToSupplier ? "bg-warning-light" :
                        (isSupplierOwes ? "bg-danger-light" : "bg-success-light");

                        <tr id="row-@r.Id" data-suppliername="@r.SupplierName.ToLower()">
                            <td>@r.Date.ToShortDateString()</td>
                            <td>@r.SupplierName</td>
                            <td>
                                <span class="status-badge @statusBg">
                                    <i class="fas @statusIcon"></i>
                                    @statusText
                                </span>
                            </td>
                            <td>@r.Total.ToString("N2")</td>
                            <td>@r.PaidAmount.ToString("N2")</td>
                            <td>@r.RefundAmount.ToString("N2")</td>
                            <td>
                                <span class="@remainingAmountClass">
                                    @Math.Abs(r.RemainingAmount).ToString("N2")
                                </span>
                            </td>

                            <td class="action-cell">
                                <a asp-action="Review" asp-route-id="@r.Id" class="action-btn edit-btn" title="عرض">
                                    <i class="fas fa-eye"></i>
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <nav>
            <ul class="pagination" id="pagination"></ul>
        </nav>
        <div class="pagination-info" id="paginationInfo"></div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const rows = Array.from(document.querySelectorAll('#tableBody tr'));
            const pageSize = 10;
            let currentPage = 1;
            const maxVisiblePages = 5;

            setupPagination();

            // Search functionality
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', function() {
                currentPage = 1;
                setupPagination();
            });

            // Pagination setup
            function setupPagination() {
                const searchText = document.getElementById('searchInput').value.toLowerCase();
                const filteredRows = rows.filter(row =>
                    row.textContent.toLowerCase().includes(searchText) ||
                    row.getAttribute('data-suppliername').includes(searchText)
                );

                const totalItems = filteredRows.length;
                const pageCount = Math.ceil(totalItems / pageSize);
                const pagination = document.getElementById('pagination');
                const startItem = ((currentPage - 1) * pageSize) + 1;
                const endItem = Math.min(currentPage * pageSize, totalItems);

                document.getElementById('paginationInfo').textContent =
                    `عرض ${startItem}-${endItem} من ${totalItems} إيصال`;

                pagination.innerHTML = '';

                if (pageCount <= 1) {
                    showPage(currentPage, filteredRows);
                    return;
                }

                // Previous button (السابق) - Points RIGHT in RTL
                const prevLi = document.createElement('li');
                prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
                prevLi.innerHTML = `<a class="page-link" href="#"><i class="fas fa-chevron-right"></i></a>`;
                if (currentPage > 1) {
                    prevLi.addEventListener('click', function(e) {
                        e.preventDefault();
                        currentPage--;
                        showPage(currentPage, filteredRows);
                        updatePagination();
                    });
                }
                pagination.appendChild(prevLi);

                let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
                let endPage = Math.min(pageCount, startPage + maxVisiblePages - 1);

                if (endPage - startPage < maxVisiblePages - 1) {
                    startPage = Math.max(1, endPage - maxVisiblePages + 1);
                }

                // Page numbers
                for (let i = startPage; i <= endPage; i++) {
                    const li = document.createElement('li');
                    li.className = `page-item ${i === currentPage ? 'active' : ''}`;
                    li.innerHTML = `<a class="page-link" href="#" data-page="${i}">${i}</a>`;
                    li.addEventListener('click', function(e) {
                        e.preventDefault();
                        currentPage = i;
                        showPage(currentPage, filteredRows);
                        updatePagination();
                    });
                    pagination.appendChild(li);
                }

                // Next button (التالي) - Points LEFT in RTL
                const nextLi = document.createElement('li');
                nextLi.className = `page-item ${currentPage === pageCount ? 'disabled' : ''}`;
                nextLi.innerHTML = `<a class="page-link" href="#"><i class="fas fa-chevron-left"></i></a>`;
                if (currentPage < pageCount) {
                    nextLi.addEventListener('click', function(e) {
                        e.preventDefault();
                        currentPage++;
                        showPage(currentPage, filteredRows);
                        updatePagination();
                    });
                }
                pagination.appendChild(nextLi);

                showPage(currentPage, filteredRows);
            }

            function showPage(page, filteredRows) {
                const start = (page - 1) * pageSize;
                const end = start + pageSize;

                rows.forEach(row => row.style.display = 'none');

                filteredRows.forEach((row, index) => {
                    row.style.display = (index >= start && index < end) ? '' : 'none';
                });
            }

            function updatePagination() {
                const pageItems = document.querySelectorAll('.page-item');
                pageItems.forEach((item, index) => {
                    if (index === 0) return;
                    if (index === pageItems.length - 1) return;
                    const pageLink = item.querySelector('a');
                    if (pageLink && pageLink.dataset.page) {
                        const pageNum = parseInt(pageLink.dataset.page);
                        item.classList.toggle('active', pageNum === currentPage);
                    }
                });
            }
        });
    </script>
}

<style>
    /* Status badges - Exact same as Out Receipts */
    .status-badge {
        padding: 0.35rem 0.75rem;
        border-radius: 50px;
        font-size: 0.875rem;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .bg-warning-light {
        background-color: rgba(245, 158, 11, 0.1);
        color: #f59e0b;
    }

    .bg-danger-light {
        background-color: rgba(239, 68, 68, 0.1);
        color: #ef4444;
    }

    .bg-success-light {
        background-color: rgba(16, 185, 129, 0.1);
        color: #10b981;
    }

    /* Text colors */
    .text-warning {
        color: #f59e0b !important;
    }

    .text-danger {
        color: #ef4444 !important;
    }

    .text-success {
        color: #10b981 !important;
    }

    

    /* Pagination - Exact same as Out Receipts */
    .pagination {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
        justify-content: center;
    }

    .page-item {
        display: inline-block;
    }

    .page-link {
        padding: 0.5rem 0.75rem;
        border-radius: 6px;
        border: 1px solid var(--gray-300);
        color: var(--gray-700);
        transition: all 0.2s ease;
    }

        .page-link:hover {
            background-color: var(--gray-100);
        }

    .page-item.active .page-link {
        background-color: var(--primary);
        color: white;
        border-color: var(--primary);
    }

    .page-item.disabled .page-link {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .pagination-info {
        text-align: center;
        margin-top: 0.5rem;
        color: var(--gray-600);
    }

   
</style>